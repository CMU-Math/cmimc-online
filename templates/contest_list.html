{% extends 'base.html' %}

{% block content %}

{% if ongoing %}
  <p class="display-4">Ongoing Contests</p>
  <hr class="red_line mb-4"/>
  <div class="card-deck-wrapper mb-5">
    {% for t in ongoing %}
      <div class="card cardlink mb-5">
        <div class="card-body">
          <h4 class="card-title">{{ t.contest.name }}</h4>
          <p>{{ t.contest.description|safe|linebreaks }}</p>
          {% if user.is_mathlete %}
            {% if t.has_team %}
              <a href="{% url 'team_info' t.team.id %}" class="btn btn-primary">
                My Team
              </a>
            {% endif %}
          {% else %}
            {% if t.has_team %}
              <a href="{% url 'coach_teams' t.contest.id %}" class="btn btn-primary">
                My Teams
              </a>
            {% endif %}
          {% endif %}

          {% if user.is_mathlete %}
            <table class="table table-bordered mt-4">
              <thead>
                <tr>
                  <th scope="col">Round</th>
                  <th scope="col">Start Time</th>
                  <th scope="col">End Time</th> 
                  <th scope="col">Enter</th>
                </tr>
              </thead>
              <tbody>
                {% for e in t.exams %}
                  <tr>
                    <td>{{ e.name }}</td>
                    <td>{{ e.start_time }}</td>
                    <td>{{ e.end_time }}</td>
                    {% if e.ended %}
                      <td>Ended</td>
                    {% elif e.ongoing %}
                      <td><a href="{% url 'all_problems' e.id %}"
                        class="btn btn-primary">Join</a></td>
                    {% else %}
                      <td>Not Started</td>
                    {% endif %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

{% if upcoming %}
  <p class="display-4">Upcoming Contests</p>
  <hr class="red_line mb-4"/>
  <div class="card-deck-wrapper mb-5">
    {% for t in upcoming %}
      <div class="card cardlink mb-5">
        <div class="card-body">
          <h4 class="card-title">{{ t.contest.name }}</h4>
          <p>{{ t.contest.description|safe|linebreaks }}</p>
          {% if user.is_mathlete %}
            {% if t.has_team %}
              <a href="{% url 'team_info' t.team.id %}" class="btn btn-primary stretched-link">
                My Team
              </a>
            {% else %}
              {% if t.contest.reg_ended %}
                <p><b>Registration has ended.</b></p>
              {% else %}
                <a href="{% url 'new_team' t.contest.id %}" class="btn btn-success stretched-link">
                  Create Team
                </a>
              {% endif %}
            {% endif %}
          {% else %}
            {% if t.has_team %}
              <a href="{% url 'coach_teams' t.contest.id %}" class="btn btn-primary stretched-link">
                My Teams
              </a>
            {% else %}
              {% if t.contest.reg_ended %}
                <p><b>Registration has ended.</b></p>
              {% else %}
                <a href="{% url 'new_team' t.contest.id %}" class="btn btn-success stretched-link">
                  Create Team
                </a>
              {% endif %}
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

{% if past %}
  <p class="display-4">Past Contests</p>
  <hr class="red_line mb-4"/>
  <div class="card-deck-wrapper">
    {% for t in past %}
      <div class="card cardlink mb-5">
        <div class="card-body">
          <h4 class="card-title">{{ t.contest.name }}</h4>
          <p>{{ t.contest.description|safe|linebreaks }}</p>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

{% if not ongoing and not upcoming and not past %}
  No contests yet.
{% endif %}

{% if user.is_staff %}
<h1 class="mt-5">Staff Info Only (regular users can't see this)</h1>
<hr class="red_line mb-4"/>
<h3>All Emails (students and coaches with an account on this website)</h3>
<p>{{ emaillist }}</p>

<h3>Unregistered Emails (students and coaches with an unregistered team)</h3>
<p>{{ unreg_emails }}</p>

<h3>Programming Contest member count</h3>
<p>{{ member_count }}</p>

<h3>Re-register all teams in a contest</h3>
<hr class="red_line mb-4"/>
<p>(resets all competitors, scores and taskscores)</p>

<form method="post" class="mb-4">
      {% csrf_token %}
      <div class="form-group">
        <input type="number" class="form-contest-id" name="finalize_all_teams">
      </div>
      <button type="submit" class="btn btn-primary">Re-register all teams</button>
</form>

<h3>Init all tasks</h3>
<hr class="red_line mb-4"/>
<form method="post">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary" name="init_all_tasks">Init All Tasks</button>
</form>

{% endif %}

{% endblock %}
