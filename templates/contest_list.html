{% extends 'base.html' %}

{% block content %}

<p class="display-4">Ongoing Contests</p>
<hr class="red_line mb-4"/>
<div class="card-deck-wrapper">
  {% for t in tuples %}
    {% if t.contest.ongoing %}
      <div class="card mb-5">
        <div class="card-body">
          <h4 class="card-title">{{ t.contest.name }}</h4>
          <p>{{ t.contest.description|safe|linebreaks }}</p>
          {% if user.is_mathlete %}
            {% if t.has_team %}
              <a href="{% url 'team_info' t.team.id %}" class="btn btn-primary">
                My Team
              </a>
            {% else %}
              <a href="{% url 'new_team' t.contest.id %}" class="btn btn-success">
                Create Team
              </a>
            {% endif %}
          {% else %}
          {% if t.has_team %}
              <a href="{% url 'coach_teams' t.contest.id %}" class="btn btn-primary stretched-link">
                My Teams
              </a>
            {% else %}
              <a href="{% url 'new_team' t.contest.id %}" class="btn btn-success stretched-link">
                Create Team
              </a>
            {% endif %}
          {% endif %}

          {% if user.is_mathlete %}
            <table class="table table-bordered mt-4">
              <thead>
                <tr>
                  <th scope="col">Round</th>
                  <th scope="col">Start Time</th>
                  <th scope="col">End Time</th> 
                  <th scope="col">Enter</th>
                </tr>
              </thead>
              <tbody>
                {% for e in t.exams %}
                  <tr>
                    <td>{{ e.name }}</td>
                    <td>{{ e.start_time }}</td>
                    <td>{{ e.end_time }}</td>
                    {% if e.ended %}
                      <td>Ended</td>
                    {% elif e.ongoing %}
                      <td><a href="{% url 'all_problems' e.id %}"
                        class="btn btn-primary">Join</a></td>
                    {% else %}
                      <td>Not Started</td>
                    {% endif %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

<p class="display-4 mt-5">Upcoming Contests</p>
<hr class="red_line mb-4"/>
<div class="card-deck-wrapper">
  {% for t in tuples %}
    {% if not t.contest.started %}
      <div class="card cardlink mb-5">
        <div class="card-body">
          <h4 class="card-title">{{ t.contest.name }}</h4>
          <p>{{ t.contest.description|safe|linebreaks }}</p>
          {% if user.is_mathlete %}
            {% if t.has_team %}
              <a href="{% url 'team_info' t.team.id %}" class="btn btn-primary stretched-link">
                My Team
              </a>
            {% else %}
              <a href="{% url 'new_team' t.contest.id %}" class="btn btn-success stretched-link">
                Create Team
              </a>
            {% endif %}
          {% else %}
          {% if t.has_team %}
              <a href="{% url 'coach_teams' t.contest.id %}" class="btn btn-primary stretched-link">
                My Teams
              </a>
            {% else %}
              <a href="{% url 'new_team' t.contest.id %}" class="btn btn-success stretched-link">
                Create Team
              </a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

<p class="display-4 mt-5">Past Contests</p>
<hr class="red_line mb-4"/>
<div class="card-deck-wrapper">
  {% for t in tuples %}
    {% if t.contest.ended %}
      <div class="card cardlink mb-5">
        <div class="card-body">
          <h4 class="card-title">{{ t.contest.name }}</h4>
          <p>{{ t.contest.description|safe|linebreaks }}</p>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

{% endblock %}
