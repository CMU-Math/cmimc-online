{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <h2 class="mb-3">Team: {{ team.team_name }}</h2>
        {% if not team.is_finalized %}
        <p>To invite new team members, send them this link: <a href="{{ invite_link }}">{{ invite_link }}</a>. They will need to log in with their own account.</p>
        {% endif %}
        {% if team.coach %}
        <h2 class="mb-3">Coach: {{ team.coach }}</h2>
        {% endif %}

        <h2>Members <span {% if too_large %}class="text-danger"{% endif %}>({{ team.mathletes.all|length }}/{{ team.contest.max_team_size }})</span></h2>
        {% if team.mathletes.all %}
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        {% if can_edit %}<th scope="col"></th>{% endif %}
                    </tr>
                </thead>
                <tbody>
                {% for mathlete in team.mathletes.all %} 
                    <tr>
                        <td>{{ mathlete.user.name }}</td>
                        <td>{{ mathlete.user.email }}</td>
                        {% if can_edit %}<td><a href="">Remove</a></td>{% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No team members yet</p>
        {% endif %}

        {% if too_large %}
        <p>You have too many members!</p>
        {% endif %}

        {% if team.is_finalized %}
        <p class="mb-4">Your team has been finalized, and can no longer be edited. If there was a mistake, please contact <a href="mailto:contact@cmimc.info">contact@cmimc.info</a>.</p>
        {% else %}
            {% if not team.coach or user == team.coach %}
            <p class="mb-4">All teams will be automatically finalized on <span class="font-weight-bold">{{ team.contest.reg_end_date.date }}</span>. You will no longer be able to invite new members or edit your team after that point.</p>
            {% endif %}

            <form method="post">
                {% csrf_token %}
                {% if user.is_mathlete %}
                    <button type="submit" name="submit" class="btn btn-danger mr-3" value="leaveTeam">Leave Team</button>
                {% else %}
                    <button type="submit" name="submit" class="btn btn-danger mr-3" value="deleteTeam">Delete Team</button>
                {% endif %}
            </form>
        {% endif %}
  </div>
</div>

{% endblock %}

